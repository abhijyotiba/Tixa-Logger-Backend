# Central Logger - Architecture & Flow Diagrams

## ğŸ“Š Overall Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT WORKFLOW                             â”‚
â”‚                       (Your Service - Phases 1-3)                  â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Execute  â”‚â”€â”€â”€â–¶â”‚   Build   â”‚â”€â”€â”€â–¶â”‚   Ship Log  â”‚â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Workflow â”‚    â”‚   Log     â”‚    â”‚   (Async)   â”‚       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚       â”‚
â”‚                                                           â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                      HTTPS POST            â”‚
                                      X-API-Key: xxx        â”‚
                                      JSON Payload          â”‚
                                                            â”‚
                                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CENTRAL LOGGER API                               â”‚
â”‚                  (This Project - Phase 4)                          â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Authenticateâ”‚â”€â”€â–¶â”‚   Validate   â”‚â”€â”€â–¶â”‚  Store in DB   â”‚        â”‚
â”‚  â”‚  (API Key)  â”‚   â”‚   Payload    â”‚   â”‚   (PostgreSQL) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              Read APIs (For Dashboard)              â”‚         â”‚
â”‚  â”‚  â€¢ GET /logs           â€¢ GET /metrics/overview      â”‚         â”‚
â”‚  â”‚  â€¢ GET /logs/{id}      â€¢ GET /metrics/categories    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      POSTGRESQL DATABASE                           â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               workflow_logs table                         â”‚    â”‚
â”‚  â”‚                                                           â”‚    â”‚
â”‚  â”‚  â€¢ Structured fields (id, client_id, status, etc.)      â”‚    â”‚
â”‚  â”‚  â€¢ JSONB fields (metrics, payload)                      â”‚    â”‚
â”‚  â”‚  â€¢ Indexes for performance                              â”‚    â”‚
â”‚  â”‚  â€¢ Tenant isolation by client_id                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DASHBOARD                                  â”‚
â”‚                    (Phase 5 - Next Step)                           â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Overview  â”‚  â”‚  Log List  â”‚  â”‚  Ticket Detail   â”‚           â”‚
â”‚  â”‚  Metrics   â”‚  â”‚  + Filters â”‚  â”‚  (Trace Viewer)  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Log Ingestion Flow (Detailed)

```
CLIENT                    API GATEWAY              AUTH                SERVICE              DATABASE
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
  â”‚  POST /api/v1/logs        â”‚                      â”‚                     â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                     â”‚                    â”‚
  â”‚  Headers:                 â”‚                      â”‚                     â”‚                    â”‚
  â”‚   X-API-Key: abc123       â”‚  Extract API Key     â”‚                     â”‚                    â”‚
  â”‚  Body: {...}              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚  Validate Key       â”‚                    â”‚
  â”‚                           â”‚                      â”‚  Resolve client_id  â”‚                    â”‚
  â”‚                           â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                    â”‚
  â”‚                           â”‚                      â”‚                â”‚    â”‚                    â”‚
  â”‚                           â”‚                      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                    â”‚
  â”‚                           â”‚   client_id="xyz"    â”‚                     â”‚                    â”‚
  â”‚                           â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
  â”‚                           â”‚  Validate Payload    â”‚                     â”‚                    â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                     â”‚                    â”‚
  â”‚                           â”‚  (Pydantic)    â”‚     â”‚                     â”‚                    â”‚
  â”‚                           â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚  Create Log Entry   â”‚                    â”‚
  â”‚                           â”‚                      â”‚   (client_id, data) â”‚                    â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚  INSERT INTO       â”‚
  â”‚                           â”‚                      â”‚                     â”‚  workflow_logs     â”‚
  â”‚                           â”‚                      â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚   Row Created      â”‚
  â”‚                           â”‚                      â”‚                     â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                           â”‚                      â”‚    log_id           â”‚                    â”‚
  â”‚                           â”‚                      â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
  â”‚                           â”‚   201 Created        â”‚                     â”‚                    â”‚
  â”‚   201 Created             â”‚ { "log_id": "..." }  â”‚                     â”‚                    â”‚
  â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                     â”‚                    â”‚
  â”‚ { "log_id": "..." }       â”‚                      â”‚                     â”‚                    â”‚
  â”‚                           â”‚                      â”‚                     â”‚                    â”‚
```

---

## ğŸ” Query Flow (Dashboard â†’ API â†’ DB)

```
DASHBOARD              API ENDPOINT              SERVICE                DATABASE
    â”‚                       â”‚                       â”‚                      â”‚
    â”‚  GET /api/v1/logs     â”‚                       â”‚                      â”‚
    â”‚  ?status=SUCCESS      â”‚                       â”‚                      â”‚
    â”‚  &page=1              â”‚                       â”‚                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                       â”‚                      â”‚
    â”‚  X-API-Key: abc123    â”‚  Auth + Parse Params  â”‚                      â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                      â”‚
    â”‚                       â”‚             â”‚         â”‚                      â”‚
    â”‚                       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚                      â”‚
    â”‚                       â”‚                       â”‚                      â”‚
    â”‚                       â”‚   Get Logs with       â”‚                      â”‚
    â”‚                       â”‚   Filters             â”‚                      â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚
    â”‚                       â”‚   (client_id, status, â”‚                      â”‚
    â”‚                       â”‚    page, page_size)   â”‚                      â”‚
    â”‚                       â”‚                       â”‚  SELECT * FROM       â”‚
    â”‚                       â”‚                       â”‚  workflow_logs       â”‚
    â”‚                       â”‚                       â”‚  WHERE client_id=?   â”‚
    â”‚                       â”‚                       â”‚  AND status=?        â”‚
    â”‚                       â”‚                       â”‚  ORDER BY executed_atâ”‚
    â”‚                       â”‚                       â”‚  LIMIT ? OFFSET ?    â”‚
    â”‚                       â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                       â”‚                       â”‚                      â”‚
    â”‚                       â”‚                       â”‚   Result Set + Count â”‚
    â”‚                       â”‚                       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                       â”‚   Logs + Pagination   â”‚                      â”‚
    â”‚                       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
    â”‚                       â”‚                       â”‚                      â”‚
    â”‚   200 OK              â”‚                       â”‚                      â”‚
    â”‚   {                   â”‚                       â”‚                      â”‚
    â”‚     data: [...],      â”‚                       â”‚                      â”‚
    â”‚     pagination: {...} â”‚                       â”‚                      â”‚
    â”‚   }                   â”‚                       â”‚                      â”‚
    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                      â”‚
    â”‚                       â”‚                       â”‚                      â”‚
```

---

## ğŸ—ï¸ Code Architecture (Layered)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HTTP LAYER                             â”‚
â”‚                   (FastAPI Routes)                         â”‚
â”‚                                                            â”‚
â”‚  app/api/                                                  â”‚
â”‚  â”œâ”€â”€ ingest.py      â† POST /logs endpoints                â”‚
â”‚  â”œâ”€â”€ read_logs.py   â† GET /logs endpoints                 â”‚
â”‚  â””â”€â”€ metrics.py     â† GET /metrics endpoints              â”‚
â”‚                                                            â”‚
â”‚  Responsibilities:                                         â”‚
â”‚  â€¢ HTTP request/response                                   â”‚
â”‚  â€¢ Route definition                                        â”‚
â”‚  â€¢ Dependency injection                                    â”‚
â”‚  â€¢ Status codes                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AUTH LAYER                               â”‚
â”‚               (API Key Validation)                         â”‚
â”‚                                                            â”‚
â”‚  app/auth/                                                 â”‚
â”‚  â””â”€â”€ api_key_auth.py                                       â”‚
â”‚                                                            â”‚
â”‚  Responsibilities:                                         â”‚
â”‚  â€¢ Validate API keys                                       â”‚
â”‚  â€¢ Resolve client_id                                       â”‚
â”‚  â€¢ 401 errors                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 VALIDATION LAYER                           â”‚
â”‚               (Pydantic Models)                            â”‚
â”‚                                                            â”‚
â”‚  app/utils/                                                â”‚
â”‚  â””â”€â”€ validators.py                                         â”‚
â”‚                                                            â”‚
â”‚  Responsibilities:                                         â”‚
â”‚  â€¢ Type checking                                           â”‚
â”‚  â€¢ Required fields                                         â”‚
â”‚  â€¢ Value validation                                        â”‚
â”‚  â€¢ 400 errors                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVICE LAYER                            â”‚
â”‚                (Business Logic)                            â”‚
â”‚                                                            â”‚
â”‚  app/services/                                             â”‚
â”‚  â””â”€â”€ log_service.py                                        â”‚
â”‚                                                            â”‚
â”‚  Responsibilities:                                         â”‚
â”‚  â€¢ CRUD operations                                         â”‚
â”‚  â€¢ Business logic                                          â”‚
â”‚  â€¢ Query building                                          â”‚
â”‚  â€¢ Data transformation                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATABASE LAYER                           â”‚
â”‚              (SQLAlchemy ORM)                              â”‚
â”‚                                                            â”‚
â”‚  app/db/                                                   â”‚
â”‚  â”œâ”€â”€ database.py    â† Connection, sessions                â”‚
â”‚  â””â”€â”€ models.py      â† ORM models                          â”‚
â”‚                                                            â”‚
â”‚  Responsibilities:                                         â”‚
â”‚  â€¢ Database connection                                     â”‚
â”‚  â€¢ Session management                                      â”‚
â”‚  â€¢ ORM mapping                                             â”‚
â”‚  â€¢ Transactions                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   POSTGRESQL                               â”‚
â”‚                workflow_logs table                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SECURITY LAYERS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. TRANSPORT SECURITY
   â”‚
   â”œâ”€ HTTPS (in production)
   â”œâ”€ TLS 1.2+
   â””â”€ Certificate validation

2. API KEY AUTHENTICATION
   â”‚
   â”œâ”€ Header: X-API-Key
   â”œâ”€ Key validation
   â”œâ”€ Client ID resolution
   â””â”€ 401 on invalid

3. INPUT VALIDATION
   â”‚
   â”œâ”€ Pydantic type checking
   â”œâ”€ Required field validation
   â”œâ”€ Enum validation
   â””â”€ 400 on invalid

4. TENANT ISOLATION
   â”‚
   â”œâ”€ Filter by client_id (always)
   â”œâ”€ No cross-client queries
   â”œâ”€ Enforced at service layer
   â””â”€ Double-check at DB level

5. ERROR HANDLING
   â”‚
   â”œâ”€ Never expose internals
   â”œâ”€ Safe error messages
   â”œâ”€ Log all errors
   â””â”€ Graceful degradation

6. DATABASE SECURITY
   â”‚
   â”œâ”€ Connection pooling
   â”œâ”€ Parameterized queries
   â”œâ”€ No raw SQL from input
   â””â”€ Transaction safety
```

---

## ğŸ“Š Data Flow (Complete Journey)

```
WORKFLOW EXECUTION
        â”‚
        â–¼
    Build Log
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â€¢ ticket_id         â”‚
    â”‚ â€¢ status            â”‚
    â”‚ â€¢ category          â”‚
    â”‚ â€¢ metrics (JSONB)   â”‚
    â”‚ â€¢ payload (JSONB)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Ship Async (Non-blocking)
               â”‚
               â–¼
    POST /api/v1/logs
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Headers:             â”‚
    â”‚  X-API-Key: abc123   â”‚
    â”‚ Body: {...}          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Authenticate
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API Key â†’ client_id  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Validate
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Pydantic checks      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Store in PostgreSQL
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT INTO          â”‚
    â”‚ workflow_logs        â”‚
    â”‚ VALUES (...)         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Return 201 Created
               â”‚
               â”‚
    â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    QUERY SIDE â”‚
               â”‚
               â–¼
    Dashboard Request
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /api/v1/logs     â”‚
    â”‚ ?filters...          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Authenticate & Query
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SELECT * FROM        â”‚
    â”‚ workflow_logs        â”‚
    â”‚ WHERE client_id=?    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Return Paginated Results
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ {                    â”‚
    â”‚   data: [...],       â”‚
    â”‚   pagination: {...}  â”‚
    â”‚ }                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    Dashboard Displays
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â€¢ Overview metrics   â”‚
    â”‚ â€¢ Log list           â”‚
    â”‚ â€¢ Trace viewer       â”‚
    â”‚ â€¢ Charts             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Phase Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 1-3 (Client Side)                 â”‚
â”‚                  âœ… COMPLETE                         â”‚
â”‚                                                      â”‚
â”‚  â€¢ Log builder                                       â”‚
â”‚  â€¢ Async log shipper                                 â”‚
â”‚  â€¢ Error handling                                    â”‚
â”‚  â€¢ Never blocks workflow                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS POST
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 4 (Provider Side)                 â”‚
â”‚                  âœ… COMPLETE                         â”‚
â”‚                                                      â”‚
â”‚  â€¢ Log ingestion API                                 â”‚
â”‚  â€¢ Authentication                                    â”‚
â”‚  â€¢ Database storage                                  â”‚
â”‚  â€¢ Read APIs                                         â”‚
â”‚  â€¢ Metrics                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP GET
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 5 (Dashboard)                     â”‚
â”‚                  ğŸ”œ NEXT                             â”‚
â”‚                                                      â”‚
â”‚  â€¢ React/Next.js UI                                  â”‚
â”‚  â€¢ Overview page                                     â”‚
â”‚  â€¢ Log list with filters                             â”‚
â”‚  â€¢ Trace viewer                                      â”‚
â”‚  â€¢ Analytics charts                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ File Organization

```
central-logger/
â”‚
â”œâ”€â”€ ğŸ“„ Configuration & Setup
â”‚   â”œâ”€â”€ .env.example           â† Environment template
â”‚   â”œâ”€â”€ .gitignore             â† Git ignore rules
â”‚   â”œâ”€â”€ requirements.txt       â† Python dependencies
â”‚   â”œâ”€â”€ setup.bat              â† Windows setup script
â”‚   â”œâ”€â”€ Dockerfile             â† Container image
â”‚   â””â”€â”€ docker-compose.yml     â† Local dev with Docker
â”‚
â”œâ”€â”€ ğŸ“š Documentation
â”‚   â”œâ”€â”€ README.md              â† Full documentation
â”‚   â”œâ”€â”€ SETUP_GUIDE.md         â† Quick start
â”‚   â”œâ”€â”€ DEPLOYMENT.md          â† Production deployment
â”‚   â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md â† What was built
â”‚   â”œâ”€â”€ QUICK_REFERENCE.md     â† Common commands
â”‚   â””â”€â”€ DIAGRAMS.md            â† This file
â”‚
â”œâ”€â”€ ğŸ“‚ app/ (Application Code)
â”‚   â”œâ”€â”€ main.py                â† FastAPI app entry
â”‚   â”œâ”€â”€ config.py              â† Configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                   â† HTTP endpoints
â”‚   â”‚   â”œâ”€â”€ ingest.py         â† POST /logs
â”‚   â”‚   â”œâ”€â”€ read_logs.py      â† GET /logs
â”‚   â”‚   â””â”€â”€ metrics.py        â† GET /metrics
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                  â† Authentication
â”‚   â”‚   â””â”€â”€ api_key_auth.py   â† API key validation
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                    â† Database
â”‚   â”‚   â”œâ”€â”€ database.py       â† Connection
â”‚   â”‚   â””â”€â”€ models.py         â† ORM models
â”‚   â”‚
â”‚   â”œâ”€â”€ services/              â† Business logic
â”‚   â”‚   â””â”€â”€ log_service.py    â† CRUD operations
â”‚   â”‚
â”‚   â””â”€â”€ utils/                 â† Utilities
â”‚       â””â”€â”€ validators.py     â† Pydantic schemas
â”‚
â””â”€â”€ ğŸ“‚ scripts/ (Helper Scripts)
    â”œâ”€â”€ init_db.py             â† Database setup
    â””â”€â”€ test_api.py            â† API testing
```

---

These diagrams provide a complete visual understanding of the Central Logger system architecture and flows.
